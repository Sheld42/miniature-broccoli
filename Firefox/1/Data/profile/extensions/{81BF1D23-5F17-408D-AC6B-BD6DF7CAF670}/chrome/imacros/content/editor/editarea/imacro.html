<html>
  <head>
    <title>iMacros Editor</title>
    <script language="javascript" type="text/javascript"
            src="edit_area/edit_area_loader.js"></script>
    <script language="javascript" type="text/javascript">

function onLoad() {
    var bypass = document.getElementById("bypass");
    bypass.addEventListener("iMacrosEditorInitEvent",
                             initEditArea, true);
    bypass.addEventListener("iMacrosEditorLoadCompleteEvent",
                             onLoadComplete, true);
    bypass.addEventListener("iMacrosEditorGetContentEvent",
                             onGetContent, true);
    bypass.addEventListener("iMacrosEditorGetSelection",
                             onGetSelection, true);
    bypass.addEventListener("iMacrosEditorSetSelection",
                             onSetSelection, true);
    bypass.setAttribute("inited", "true");    
}


function initEditArea() {
    var bypass = document.getElementById("bypass");

    if (!bypass.hasAttribute("lang") || !bypass.hasAttribute("syntax")) {
        alert("Can not initiate editor!");
        return;
    }
    
    var config = {
        id: "textarea",
        syntax: bypass.getAttribute("syntax"),
        start_highlight: true,
        allow_toggle: false,
        toolbar: "save, load, |, undo, redo, |, search, |, select_font, syntax_selection",
        syntax_selection_allow: "imacro, js",
        language: bypass.getAttribute("lang"),
        allow_resize: "no",
        load_callback: "onLoadFile",
        save_callback: "onSaveFile"
    };
    editAreaLoader.init(config);
}
    

function onSaveFile(id, content) {
    var bypass = document.getElementById("bypass");
    var evt = document.createEvent("Events");
    evt.initEvent("iMacrosEditorSaveEvent", true, false);
    bypass.setAttribute("content", content);
    bypass.dispatchEvent(evt);
}


function onLoadFile(id) {
    var bypass = document.getElementById("bypass");
    var evt = document.createEvent("Events");
    evt.initEvent("iMacrosEditorLoadEvent", true, false);
    bypass.dispatchEvent(evt);
}


function onLoadComplete() {
    var bypass = document.getElementById("bypass");
    var content = bypass.getAttribute("content");
    editAreaLoader.setValue("textarea", content);
    editAreaLoader.execCommand("textarea",
              "change_syntax", bypass.getAttribute("syntax"));
    if (bypass.hasAttribute("start") && bypass.hasAttribute("end")) {
        editAreaLoader.setSelectionRange(
            "textarea",
            parseInt(bypass.getAttribute("start")),
            parseInt(bypass.getAttribute("end"))
        );
    }
}

function onGetContent() {
    var bypass = document.getElementById("bypass");
    bypass.setAttribute("content",
          editAreaLoader.getValue("textarea"));
}

function onGetSelection() {
    var bypass = document.getElementById("bypass");
    bypass.setAttribute("selection",
                        editAreaLoader.getSelectedText("textarea"));
}

function onSetSelection() {
    var bypass = document.getElementById("bypass");
    var selection = bypass.getAttribute("selection");
    editAreaLoader.setSelectedText("textarea", selection);
}



      
    </script>
  </head>
  <body style="padding: 0px; margin: 0px;" onload="onLoad()">
    <form method="post">
      <textarea id="textarea" name="content" 
                style="width: 100%; height: 95%"></textarea>
    </form>
    <div id="bypass" style="display:none"></div>
  </body>
</html>
